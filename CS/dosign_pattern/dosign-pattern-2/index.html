<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=rgba(0,0,0,0)><meta name=generator content="Hexo 6.3.0"><link rel=preconnect href=//fonts.loli.net crossorigin><link rel=preconnect href=null//null crossorigin><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=mask-icon href=/images/logo.svg color=rgba(0,0,0,0)><link rel=manifest href=/images/manifest.json><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/orange/pace-theme-big-counter.css><script src=https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin=anonymous></script><script class=next-config data-name=main type=application/json>{"hostname":"blog.bysegfault.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta name=description content="组件协同模式 现代软件专业分工之后的第一个结果是「框架与应用程序的划分」，「组件协作」模式通过晚期绑定，来实现框架与应用程序之间的松耦合，是二者之间协作时的常用模式。 下面是组件协同模式的三种典型模式。  Template Method（模板方法） 模板方法，就像高中老师讲的做题步骤一样，比如高考卷里的圆锥曲线题。  先设直线方程 把直线方程代入圆锥曲线 利用求根公式的定理，算出x1+x2,x1"><meta property=og:type content=blog><meta property=og:title content=设计模式-23种（二）><meta property=og:url content=https://blog.bysegfault.com/CS/dosign_pattern/dosign-pattern-2/index.html><meta property=og:site_name content="ohayo&#39;s blog"><meta property=og:description content="组件协同模式 现代软件专业分工之后的第一个结果是「框架与应用程序的划分」，「组件协作」模式通过晚期绑定，来实现框架与应用程序之间的松耦合，是二者之间协作时的常用模式。 下面是组件协同模式的三种典型模式。  Template Method（模板方法） 模板方法，就像高中老师讲的做题步骤一样，比如高考卷里的圆锥曲线题。  先设直线方程 把直线方程代入圆锥曲线 利用求根公式的定理，算出x1+x2,x1"><meta property=og:locale content=zh_CN><meta property=og:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230424215309.png><meta property=og:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230424225921.png><meta property=og:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230425214659.png><meta property=og:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230425215654.png><meta property=og:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/Pasted%20image%2020230427013929.png><meta property=og:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/Pasted%20image%2020230428012216.png><meta property=og:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/Pasted%20image%2020230428224539.png><meta property=article:published_time content=2023-04-23T12:25:31.000Z><meta property=article:modified_time content=2024-11-23T13:39:43.353Z><meta property=article:author content=ohayo><meta property=article:tag content=cpp><meta name=twitter:card content=summary><meta name=twitter:image content=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230424215309.png><link rel=canonical href=https://blog.bysegfault.com/CS/dosign_pattern/dosign-pattern-2/ ><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.bysegfault.com/CS/dosign_pattern/dosign-pattern-2/","path":"CS/dosign_pattern/dosign-pattern-2/","title":"设计模式-23种（二）"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>设计模式-23种（二） | ohayo's blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><p class=site-title>ohayo's blog</p><i class=logo-line></i></a></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-journal"><a href=/categories/journal/index.html rel=section><i class="fa fa-book-journal-whills fa-fw"></i>Journal</a></li><li class="menu-item menu-item-test"><a href=https://test.ohayo.live/ rel=noopener target=_blank><i class="fa fa-book fa-fw"></i>Test</a></li><li class="menu-item menu-item-friend"><a href=/friends/index.html rel=section><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href=/about/index.html rel=section><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link href=#%E7%BB%84%E4%BB%B6%E5%8D%8F%E5%90%8C%E6%A8%A1%E5%BC%8F><span class=nav-number>1.</span> <span class=nav-text>组件协同模式</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#template-method%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95><span class=nav-number>1.1.</span> <span class=nav-text>Template Method（模板方法）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%BB%E7%BB%93><span class=nav-number>1.1.1.</span> <span class=nav-text>总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#strategy%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F><span class=nav-number>1.2.</span> <span class=nav-text>Strategy（策略模式）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%BB%E7%BB%93-2><span class=nav-number>1.2.1.</span> <span class=nav-text>总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#observe-event%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F><span class=nav-number>1.3.</span> <span class=nav-text>Observe | Event（观察者模式）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%BB%E7%BB%93-3><span class=nav-number>1.3.1.</span> <span class=nav-text>总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class=nav-link href=#%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E6%A8%A1%E5%BC%8F><span class=nav-number>2.</span> <span class=nav-text>单一职责模式</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#decorator%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F><span class=nav-number>2.1.</span> <span class=nav-text>Decorator（装饰器模式）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%BB%E7%BB%93-4><span class=nav-number>2.1.1.</span> <span class=nav-text>总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#bridge%E6%A1%A5%E6%A8%A1%E5%BC%8F><span class=nav-number>2.2.</span> <span class=nav-text>Bridge（桥模式）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%BB%E7%BB%93-5><span class=nav-number>2.2.1.</span> <span class=nav-text>总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class=nav-link href=#%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%BC%8F><span class=nav-number>3.</span> <span class=nav-text>对象创建模式</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=ohayo src=/images/avatar.png><p class=site-author-name itemprop=name>ohayo</p><div class=site-description itemprop=description></div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/ ><span class=site-state-item-count>28</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/ ><span class=site-state-item-count>22</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/ ><span class=site-state-item-count>17</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><a href=https://github.com/zhu-jiyuan title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhu-jiyuan" rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item><a href=mailto:ohayo1213@outlook.com title="E-Mail → mailto:ohayo1213@outlook.com" rel=noopener target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class=links-of-author-item><a href=/atom.xml title="RSS → &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a></span></div></div></div><div class="back-to-top animated" role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class=sidebar-dimmer></div></header><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang=zh-CN><link itemprop=mainEntityOfPage href=https://blog.bysegfault.com/CS/dosign_pattern/dosign-pattern-2/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.png><meta itemprop=name content=ohayo></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="ohayo's blog"><meta itemprop=description content=""></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="设计模式-23种（二） | ohayo's blog"><meta itemprop=description content=""></span><header class=post-header><h1 class=post-title itemprop="name headline">设计模式-23种（二）</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i> </span><span class=post-meta-item-text>发表于</span> <time title="创建时间：2023-04-23 20:25:31" itemprop="dateCreated datePublished" datetime=2023-04-23T20:25:31+08:00>2023-04-23</time> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i> </span><span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-11-23 21:39:43" itemprop=dateModified datetime=2024-11-23T21:39:43+08:00>2024-11-23</time> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i> </span><span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/code/ itemprop=url rel=index><span itemprop=name>code</span></a> </span></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-comment"></i> </span><span class=post-meta-item-text>Disqus：</span> <a title=disqus href=/CS/dosign_pattern/dosign-pattern-2/#disqus_thread itemprop=discussionUrl><span class="post-comments-count disqus-comment-count" data-disqus-identifier=CS/dosign_pattern/dosign-pattern-2/ itemprop=commentCount></span></a></span></div></div></header><div class=post-body itemprop=articleBody><h1 id=组件协同模式><a class=markdownIt-Anchor href=#组件协同模式></a> 组件协同模式</h1><p>现代软件专业分工之后的第一个结果是「框架与应用程序的划分」，「组件协作」模式通过晚期绑定，来实现框架与应用程序之间的松耦合，是二者之间协作时的常用模式。<br>下面是组件协同模式的三种典型模式。</p><h2 id=template-method模板方法><a class=markdownIt-Anchor href=#template-method模板方法></a> Template Method（模板方法）</h2><p>模板方法，就像高中老师讲的做题步骤一样，比如高考卷里的圆锥曲线题。</p><ol><li>先设直线方程</li><li>把直线方程代入圆锥曲线</li><li>利用求根公式的定理，算出<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=true>,</mo><msub><mi>x</mi><mn>1</mn></msub><mo>∗</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>x_{1}+x_{2},x_{1}*x_{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.73333em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.30110799999999993em;><span style=top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.6597200000000001em;vertical-align:-0.19444em;></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.30110799999999993em;><span style=top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:0.16666666666666666em;></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.30110799999999993em;><span style=top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>∗</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.58056em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.30110799999999993em;><span style=top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span></span></span></span></li><li>…<br>很多时候，题目都可以用这样一个通用的模板方法来解决，只需换掉一丢丢的不同，大致步骤都是一样。</li></ol><p>在代码编程中，模板方法就使用的相当多，通常，子类只需要重写父类给出的「可重写的方法」即可。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token comment">//base class</span>
<span class="token keyword">class</span> <span class="token class-name">Library</span><span class="token punctuation">&#123;</span>

<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token comment">//稳定 template method</span>

    <span class="token keyword">void</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token function">Step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Step2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//支持变化 ==> 虚函数的多态调用</span>

            <span class="token function">Step3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

            <span class="token function">Step4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//支持变化 ==> 虚函数的多态调用</span>

        <span class="token punctuation">&#125;</span>
        <span class="token function">Step5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Library</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>

    <span class="token keyword">void</span> <span class="token function">Step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//稳定</span>

        <span class="token comment">//.....</span>

    <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">Step3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//稳定</span>

        <span class="token comment">//.....</span>

    <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">Step5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//稳定</span>

        <span class="token comment">//.....</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">Step2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//变化</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Step4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//变化</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个例子中base类给出了两个纯虚函数，我们可以override这两个函数，做一些符合自己的变化。</p><p>在调用的时候只需如下即可。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	Library <span class="token operator">*</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Application 是Library的子类，并且重写了两个纯虚虚函数</span>
	app<span class="token operator">-></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span></span></code></pre><p>熟悉安卓开发的同学，应该非常熟悉，很多时候，都是重写一个函数，例如生命周期的resume，stop函数等等，系统会自动调用，你重写之后的方法，是不是很神奇嘞，其中的奥秘就是这样捏。</p><h3 id=总结><a class=markdownIt-Anchor href=#总结></a> 总结</h3><p><strong>定义：「定义一个操作中的算法的骨架（稳定），而将一些步骤延迟（变化）到子类中。Template Method使得子类可以不改变（复用）一个算法的结构即可重定义（override重写）该算法的某些特定步骤」</strong></p><p>下面是它的结构图。<br><img data-src=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230424215309.png alt=image.png><br>模板方法是不是很好用，不要你调用我！让我来调用你。</p><h2 id=strategy策略模式><a class=markdownIt-Anchor href=#strategy策略模式></a> Strategy（策略模式）</h2><p>策略模式特别像模板方法。举个栗子，就能马上明白。</p><p>比如应用程序切换语言。<br>语言可能以后还会添加，可能有些人会这样写程序。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">enum</span> <span class="token class-name">Language</span><span class="token punctuation">&#123;</span>
	ZH_CN<span class="token punctuation">,</span>
	ENGLISH
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	Language cur_set_lang <span class="token operator">=</span> <span class="token function">get_cur_lang</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>cur_set_lang<span class="token operator">==</span>ZH_CN<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//中文处理</span>
	<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cur_set_lang<span class="token operator">==</span>ENGLISH<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//英文处理</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>试想一下，我们现在要增加另一门语言，比如台湾繁体。在上述代码里，就要在枚举类型中添加，同时还要在main函数中的if判断中增加新的处理。<br>当项目大起来时，直接修改，往往会令人抓狂。这十分的不优雅。</p><p>策略模式，就可以很好的解决这个问题。<br>可以看出来，每个if中都要对相应的语言做处理，我们可以给它抽象出来。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">Language</span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Language</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>天啊，看到这里，相比你已经知道了后续部分了，没错就像模板方法一样。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token comment">//中文类cpp文件</span>
<span class="token keyword">class</span> <span class="token class-name">Chinese</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Language</span></span><span class="token punctuation">&#123;</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">override</span><span class="token punctuation">&#123;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//中文处理</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Chinese</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//相关资源释放</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">//英文类cpp文件</span>
<span class="token keyword">class</span> <span class="token class-name">English</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Language</span></span><span class="token punctuation">&#123;</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">override</span><span class="token punctuation">&#123;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//英文处理</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">English</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//相关资源释放</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如此这般，添加新语言，只需要创建一个新的class类文件即可，避免了直接在源码上修改。<br>调用过程也变的简洁明了。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token comment">//值得一提的是，一般会与工厂方法一起使用，因为工厂方法还没介绍，先不要啦。</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	Language<span class="token operator">*</span> cur_set_lang <span class="token operator">=</span> <span class="token function">get_cur_lang</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cur_set_lang<span class="token operator">-></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id=总结-2><a class=markdownIt-Anchor href=#总结-2></a> 总结</h3><p><strong>定义：「定义一系列算法，把它们一个个封装起来，并且使他们可互相替换（变化）。该模式使得算法可独立于使用它的客户程序（稳定）而变化（扩展，子变化）。」</strong></p><p>结构如下<br><img data-src=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230424225921.png alt=image.png><br>策略模式，可以很好的解决if else 这种没有止境或者不确定后续是否还会添加其他选项的代码，实在是妙啊。</p><h2 id=observe-event观察者模式><a class=markdownIt-Anchor href=#observe-event观察者模式></a> Observe | Event（观察者模式）</h2><p>观察者一般都是站在第三方角度上，observe中文有着「观察」的意思，而Event有着「事件」的意思，从字面意思上直观了解，不是那么容易懂。举个例子，当一个程序跑起来了，我们想看一下中间过程中发生的情况，这时我们就可以插入一段「代码（像Log）」可以让我们观察程序中间过程中的执行情况，也可以把这个观察，说成一种事件，「观察程序中间过程」事件。</p><p>比如一个分割文件的程序，我们想加一个进度条来显示实时进度，先来看一个简单的例子。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token comment">//main.cpp</span>
<span class="token keyword">class</span> <span class="token class-name">MainForm</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Form</span></span>

<span class="token punctuation">&#123;</span>

    TextBox<span class="token operator">*</span> txtFilePath<span class="token punctuation">;</span>

    TextBox<span class="token operator">*</span> txtFileNumber<span class="token punctuation">;</span>

    ProgressBar<span class="token operator">*</span> progressBar<span class="token punctuation">;</span>

  

<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token keyword">void</span> <span class="token function">Button1_Click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        string filePath <span class="token operator">=</span> txtFilePath<span class="token operator">-></span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>txtFileNumber<span class="token operator">-></span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        FileSplitter <span class="token function">splitter</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> number<span class="token punctuation">,</span> progressBar<span class="token punctuation">)</span><span class="token punctuation">;</span>
        splitter<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在上面这段代码里，我们像<code>FileSplitter</code>类中传入了一个进度条实例来显示进度。<br>如果我们的<code>FileSplitter</code>类如下。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token comment">//FileSplitter.cpp</span>
<span class="token keyword">class</span> <span class="token class-name">FileSplitter</span>

<span class="token punctuation">&#123;</span>

    string m_filePath<span class="token punctuation">;</span>

    <span class="token keyword">int</span> m_fileNumber<span class="token punctuation">;</span>

    ProgressBar<span class="token operator">*</span> m_progressBar<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token function">FileSplitter</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> filePath<span class="token punctuation">,</span> <span class="token keyword">int</span> fileNumber<span class="token punctuation">,</span> ProgressBar<span class="token operator">*</span> progressBar<span class="token punctuation">)</span> <span class="token operator">:</span>

        <span class="token function">m_filePath</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token function">m_fileNumber</span><span class="token punctuation">(</span>fileNumber<span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token function">m_progressBar</span><span class="token punctuation">(</span>progressBar<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>


        <span class="token comment">//1.读取大文件</span>
        <span class="token comment">//2.分批次向小文件中写入</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_fileNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

            <span class="token comment">//...</span>

            <span class="token keyword">float</span> progressValue <span class="token operator">=</span> m_fileNumber<span class="token punctuation">;</span>

            progressValue <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> progressValue<span class="token punctuation">;</span>

            m_progressBar<span class="token operator">-></span><span class="token function">setValue</span><span class="token punctuation">(</span>progressValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样写没毛病，让我们试想一下，如果此时我们再加一个进度条，比如在终端上打印进度信息，或者再加几个观察进度程序，如此上面的<code>FileSplitter</code>类将不能满足我们的要求。</p><p>『我们有时需要让一个类引起的变化，通知到其他一个或多个类。 』</p><p>继续之前的例子，按照我们的要求，当<code>FileSplitter</code>类变化时，其中我们加入的多个进度条类也会发生变化，也就是说<code>FileSplitter</code>类变化会通知其他进度条类。<br><img data-src=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230425214659.png alt=image.png></p><p>这些需要<code>FileSplitter</code>类应该具有一些共同的函数等，可以把这些东西给抽象为一个接口。<br>例如这样</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">IProgress</span><span class="token punctuation">&#123;</span>

<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DoProgress</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">IProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时<code>FileSplitter</code>类就要这样修改了</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">FileSplitter</span>

<span class="token punctuation">&#123;</span>

    string m_filePath<span class="token punctuation">;</span>

    <span class="token keyword">int</span> m_fileNumber<span class="token punctuation">;</span>

    List<span class="token operator">&lt;</span>IProgress<span class="token operator">*</span><span class="token operator">></span>  m_iprogressList<span class="token punctuation">;</span> <span class="token comment">// 抽象通知机制，支持多个观察者</span>

<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token function">FileSplitter</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> filePath<span class="token punctuation">,</span> <span class="token keyword">int</span> fileNumber<span class="token punctuation">)</span> <span class="token operator">:</span>

        <span class="token function">m_filePath</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token function">m_fileNumber</span><span class="token punctuation">(</span>fileNumber<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>


    <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token comment">//1.读取大文件</span>
        <span class="token comment">//2.分批次向小文件中写入</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_fileNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

            <span class="token comment">//...</span>
            <span class="token keyword">float</span> progressValue <span class="token operator">=</span> m_fileNumber<span class="token punctuation">;</span>

            progressValue <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> progressValue<span class="token punctuation">;</span>

            <span class="token function">onProgress</span><span class="token punctuation">(</span>progressValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送通知</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">void</span> <span class="token function">addIProgress</span><span class="token punctuation">(</span>IProgress<span class="token operator">*</span> iprogress<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        m_iprogressList<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>iprogress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>


    <span class="token keyword">void</span> <span class="token function">removeIProgress</span><span class="token punctuation">(</span>IProgress<span class="token operator">*</span> iprogress<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        m_iprogressList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>iprogress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


<span class="token keyword">protected</span><span class="token operator">:</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">onProgress</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">auto</span> itor<span class="token operator">=</span>m_iprogressList<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>itor <span class="token operator">!=</span> m_iprogressList<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

            <span class="token punctuation">(</span><span class="token operator">*</span>itor<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">DoProgress</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//更新进度条</span>

            itor<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们用一个<code>vector</code>容器存储需要通知的类，这些需要通知的类，需要继承<code>IProgress</code>接口，并且实现其中的纯虚函数，如此，我们就可以这样很方便的完成需求。<br>调用如下</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">MainForm</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Form</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">IProgress</span></span>

<span class="token punctuation">&#123;</span>

    TextBox<span class="token operator">*</span> txtFilePath<span class="token punctuation">;</span>

    TextBox<span class="token operator">*</span> txtFileNumber<span class="token punctuation">;</span>
    ProgressBar<span class="token operator">*</span> progressBar<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token keyword">void</span> <span class="token function">Button1_Click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        string filePath <span class="token operator">=</span> txtFilePath<span class="token operator">-></span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>txtFileNumber<span class="token operator">-></span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ConsoleNotifier cn<span class="token punctuation">;</span>
        FileSplitter <span class="token function">splitter</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

        splitter<span class="token punctuation">.</span><span class="token function">addIProgress</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//订阅通知</span>

        splitter<span class="token punctuation">.</span><span class="token function">addIProgress</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cn<span class="token punctuation">)</span>； <span class="token comment">//订阅通知</span>

        splitter<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        splitter<span class="token punctuation">.</span><span class="token function">removeIProgress</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DoProgress</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span><span class="token keyword">override</span><span class="token punctuation">&#123;</span>

        progressBar<span class="token operator">-></span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ConsoleNotifier</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">IProgress</span></span> <span class="token punctuation">&#123;</span>

<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DoProgress</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span><span class="token keyword">override</span><span class="token punctuation">&#123;</span>

        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"."</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id=总结-3><a class=markdownIt-Anchor href=#总结-3></a> 总结</h3><p><strong>定义：「定义对象间的一种一对多（变化）的依赖关系，以便当一个对象（subject）的状态发生改变时，所有依赖于它的对象都得到通知并自动更新。」</strong></p><p>结构如下<br><img data-src=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/20230425215654.png alt=image.png></p><p>是不是有种学到啦的感觉，观察者模式，可以让一个类通知许多类的改变，仅仅把这些的共同地方抽象出来，就可以让 代码变的健壮起来。</p><hr><h1 id=单一职责模式><a class=markdownIt-Anchor href=#单一职责模式></a> 单一职责模式</h1><p>在软件组件的设计中，如果责任划分的不清晰，使用继承得到的结果往往是随着需求的变化，子类急剧膨胀，同时充斥着重复代码，这时候的关键是<strong>划清责任</strong>。</p><p>下面介绍两种经典的单一职责模式可以很快帮助我们理解。</p><h2 id=decorator装饰器模式><a class=markdownIt-Anchor href=#decorator装饰器模式></a> Decorator（装饰器模式）</h2><p>比如我们要做一个基于TCP的文件传输的小工具，IO方面，我们肯定需要处理文件流、网络流，甚至可能需要对这些流进行加密，或者对流进行缓存。</p><p>那么如果我们这些写，先抽象一个<code>Stream</code>的抽象类，包含<code>read(),seek(),write()</code> 三种方法。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">Stream</span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span>：
    <span class="token keyword">virtual</span> <span class="token keyword">char</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Seek</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword">char</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>很容易就会想到文件流、网络流继承<code>Stream</code>。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">FileStream</span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span>：
    <span class="token keyword">virtual</span> <span class="token keyword">char</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Seek</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword">char</span> data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">NetworkStream</span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span>：
    <span class="token keyword">virtual</span> <span class="token keyword">char</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Seek</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword">char</span> data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>假设现在我们需要加密流和缓存流，新手一般会这样写。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">CryptoFileStream</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">FileStream</span></span><span class="token punctuation">&#123;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">char</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        <span class="token class-name">FileStream</span><span class="token double-colon punctuation">::</span><span class="token function">Read</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读文件流</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Seek</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        <span class="token class-name">FileStream</span><span class="token double-colon punctuation">::</span><span class="token function">Seek</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定位文件流</span>
        <span class="token comment">//额外的加密操作...</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>byte data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        <span class="token class-name">FileStream</span><span class="token double-colon punctuation">::</span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写文件流</span>
        <span class="token comment">//额外的加密操作...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CryptoNetworkStream</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token operator">:</span><span class="token keyword">public</span> <span class="token class-name">NetworkStream</span></span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">char</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        <span class="token class-name">NetworkStream</span><span class="token double-colon punctuation">::</span><span class="token function">Read</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读网络流</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Seek</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        <span class="token class-name">NetworkStream</span><span class="token double-colon punctuation">::</span><span class="token function">Seek</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定位网络流</span>
        <span class="token comment">//额外的加密操作...</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>byte data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        <span class="token class-name">NetworkStream</span><span class="token double-colon punctuation">::</span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写网络流</span>
        <span class="token comment">//额外的加密操作...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">//-------------------</span>
<span class="token comment">//缓存流</span>
<span class="token keyword">class</span> <span class="token class-name">BufferFileStream</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">FileStream</span></span><span class="token punctuation">&#123;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">BufferNetworkStream</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">FileStream</span></span><span class="token punctuation">&#123;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在，回头看一下代码，很明显，每当我们去添加一个扩展功能类，比如反转流，这样就要再继承 <code>FileStream、NetworkStream</code>写两个类，或者当我们去添加一个流，比如内存流，这样就要继承内存流去写很多扩展类。</p><p>假设，<code>FileStream、NetworkStream</code>这样的类有<strong>N</strong>个，加密流这样的扩展有<strong>M</strong>个，那么一共要写<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>1</mn><mo>+</mo><mi>N</mi><mo>+</mo><mi>N</mi><mo>∗</mo><mi>M</mi></mrow><annotation encoding=application/x-tex>1+N+N*M</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.72777em;vertical-align:-0.08333em;></span><span class=mord>1</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.76666em;vertical-align:-0.08333em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>N</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.68333em;vertical-align:0em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>N</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>∗</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.68333em;vertical-align:0em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>M</span></span></span></span>个。<br><img data-src=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/Pasted%20image%2020230427013929.png alt="Pasted image 20230427013929"><br>不难发现，在扩展类中，实现的东西都相同，很容易联系到多态。那么扩展类就可以写成下面这样，比如<code>CryptoStream</code>类。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">CryptoStream</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Stream</span></span><span class="token punctuation">&#123;</span>
Stream<span class="token operator">*</span> stream<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">CryptoStream</span><span class="token punctuation">(</span>Stream<span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">stream</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>	
	<span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">char</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        stream<span class="token operator">-></span><span class="token function">Read</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读文件流</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Seek</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        stream<span class="token operator">-></span><span class="token function">Seek</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定位文件流</span>
        <span class="token comment">//额外的加密操作...</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>byte data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//额外的加密操作...</span>
        stream<span class="token operator">-></span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写文件流</span>
        <span class="token comment">//额外的加密操作...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如此我们就可以省下很多重复的代码，只需要<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>1</mn><mo>+</mo><mi>N</mi><mo>+</mo><mi>M</mi></mrow><annotation encoding=application/x-tex>1+N+M</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.72777em;vertical-align:-0.08333em;></span><span class=mord>1</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.76666em;vertical-align:-0.08333em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>N</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.68333em;vertical-align:0em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>M</span></span></span></span>，非常nice。但是当我写出<code>BufferStream</code>类时，你会发现这其中又可以提出来共同的成员。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">BufferStream</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Stream</span></span><span class="token punctuation">&#123;</span>
Stream<span class="token operator">*</span> stream<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">BufferStream</span><span class="token punctuation">(</span>Stream<span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">stream</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>	
	<span class="token punctuation">&#125;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到<code>stream</code>这个成员变量重复了，可以把这个给抽出来，单独写成一个类。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp>DecoratorStream<span class="token operator">:</span> <span class="token keyword">public</span> Stream<span class="token punctuation">&#123;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    Stream<span class="token operator">*</span> stream<span class="token punctuation">;</span><span class="token comment">//...</span>
    <span class="token function">DecoratorStream</span><span class="token punctuation">(</span>Stream <span class="token operator">*</span> stm<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">stream</span><span class="token punctuation">(</span>stm<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样在以后写扩展类时，继承这个<code>DecoratorStream</code>，既可以清楚意图，又减少了代码的重复。<br>例如<code>BufferStream</code>类就可以写成下面这样。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">BufferStream</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">DecoratorStream</span></span><span class="token punctuation">&#123;</span>

<span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token function">BufferStream</span><span class="token punctuation">(</span>Stream<span class="token operator">*</span> stm<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">DecoratorStream</span><span class="token punctuation">(</span>stm<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token comment">//...</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用程序如下</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">void</span> <span class="token function">Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//运行时装配</span>
    FileStream<span class="token operator">*</span> s1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">FileStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CryptoStream<span class="token operator">*</span> s2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">CryptoStream</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BufferStream<span class="token operator">*</span> s3<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">BufferedStream</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BufferStream<span class="token operator">*</span> s4<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">BufferedStream</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id=总结-4><a class=markdownIt-Anchor href=#总结-4></a> 总结</h3><p>定义：动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator模式比生成子类（继承）更为灵活（消除重复代码&amp;减少子类个数）</p><p>结构如下<br><img data-src=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/Pasted%20image%2020230428012216.png alt="Pasted image 20230428012216"><br><strong>仔细想想，其实CryptoFileStream继承FileStream是不合理的，因为前者仅仅是后者的一个扩展，并没有is a的关系，也不朝着同一个方向变化。</strong></p><h2 id=bridge桥模式><a class=markdownIt-Anchor href=#bridge桥模式></a> Bridge（桥模式）</h2><p>桥模式与装饰器模式十分相似，都是为了解决继承使得类数量爆炸增长的问题。</p><p>举个例子，现在要开发一个即时通讯软件，新手一般会先抽象一个类。<br>比如</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">Messager</span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Login</span><span class="token punctuation">(</span>string username<span class="token punctuation">,</span> string password<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>string message<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendPicture</span><span class="token punctuation">(</span>Image image<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Messager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这很不错，PC和mobile端继承Messager，后续再继承pc类开发pc上的不同版本，例如lite，prefect版本等等。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">PCMessagerBase</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Messager</span></span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//**********</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//*********</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//**********</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//**********</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MobileMessagerBase</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Messager</span></span><span class="token punctuation">&#123;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着写一下PC端的版本。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">PCMessagerLite</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">PCMessagerBase</span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Login</span><span class="token punctuation">(</span>string username<span class="token punctuation">,</span> string password<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>string message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendPicture</span><span class="token punctuation">(</span>Image image<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  
  
  

<span class="token keyword">class</span> <span class="token class-name">PCMessagerPerfect</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">PCMessagerBase</span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Login</span><span class="token punctuation">(</span>string username<span class="token punctuation">,</span> string password<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//********</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>string message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//********</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendPicture</span><span class="token punctuation">(</span>Image image<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//********</span>
        <span class="token class-name">PCMessagerBase</span><span class="token double-colon punctuation">::</span><span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这仅仅是PC端的，如果算上mobile端，又要加上两个业务类，加一个Linux平台，可能就要一个Linux base类，和两个业务类。<br>假如有N个平台，M个版本 ，那么总共就要写<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>1</mn><mo>+</mo><mi>N</mi><mo>+</mo><mi>N</mi><mo>∗</mo><mi>M</mi></mrow><annotation encoding=application/x-tex>1+N+N*M</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.72777em;vertical-align:-0.08333em;></span><span class=mord>1</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.76666em;vertical-align:-0.08333em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>N</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.68333em;vertical-align:0em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>N</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>∗</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.68333em;vertical-align:0em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>M</span></span></span></span>个类，想想就十分可怕。</p><p>学习过上一节，很自然就会想「能不能使用多态来代替这个继承」。</p><p>首先我们先把<code>Messager</code>类分开，因为pc base类与mobile base类，仅仅实现了基础的部分，并没有实现login这些功能。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">Messager</span><span class="token punctuation">&#123;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
     MessagerImp<span class="token operator">*</span> messagerImp<span class="token punctuation">;</span><span class="token comment">//...</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Login</span><span class="token punctuation">(</span>string username<span class="token punctuation">,</span> string password<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>string message<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendPicture</span><span class="token punctuation">(</span>Image image<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Messager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  
<span class="token keyword">class</span> <span class="token class-name">MessagerImp</span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">virtual</span> <span class="token function">MessagerImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面只需让pc base类与mobile base类去实现MessagerImp接口，而业务类继承<code>Messager</code>类。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">PCMessagerImp</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">MessagerImp</span></span><span class="token punctuation">&#123;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//**********</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//**********</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//**********</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//**********</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>


<span class="token keyword">class</span> <span class="token class-name">MobileMessagerImp</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">MessagerImp</span></span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">MessagerLite</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Messager</span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Login</span><span class="token punctuation">(</span>string username<span class="token punctuation">,</span> string password<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        messagerImp<span class="token operator">-></span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>string message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        messagerImp<span class="token operator">-></span><span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendPicture</span><span class="token punctuation">(</span>Image image<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        messagerImp<span class="token operator">-></span><span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MessagerPerfect</span>  <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Messager</span> 
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token class-name">string</span> <span class="token class-name">username</span><span class="token punctuation">,</span> <span class="token class-name">string</span> <span class="token class-name">password</span><span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>
        messagerImp<span class="token operator">-></span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//********</span>
        messagerImp<span class="token operator">-></span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>string message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        messagerImp<span class="token operator">-></span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//********</span>
        messagerImp<span class="token operator">-></span><span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//........</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SendPicture</span><span class="token punctuation">(</span>Image image<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        messagerImp<span class="token operator">-></span><span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//********</span>
        messagerImp<span class="token operator">-></span><span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//........</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样类的数量就缩短到了<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>1</mn><mo>+</mo><mi>N</mi><mo>+</mo><mi>M</mi></mrow><annotation encoding=application/x-tex>1+N+M</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.72777em;vertical-align:-0.08333em;></span><span class=mord>1</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.76666em;vertical-align:-0.08333em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>N</span><span class=mspace style=margin-right:0.2222222222222222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222222222222222em;></span></span><span class=base><span class=strut style=height:0.68333em;vertical-align:0em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>M</span></span></span></span>.<br>调用主程序，可以写成如下格式。</p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp>PCMessagerImp <span class="token operator">*</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">PCMessagerImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Messager<span class="token operator">*</span> mp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MessagerPerfect</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">;</span>
Messager<span class="token operator">*</span> ml <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MessagerLite</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span></span></code></pre><h3 id=总结-5><a class=markdownIt-Anchor href=#总结-5></a> 总结</h3><p><strong>定义：将抽象部分（业务功能）与实现部分（平台实现）分离，使它们都可以独立地变化。</strong></p><p>结构如下<br><img data-src=https://fastly.jsdelivr.net/gh/zhu-jiyuan/picture_go@master/img/Pasted%20image%2020230428224539.png alt="Pasted image 20230428224539"><br>桥模式与装饰器模式，都有异曲同工之妙，都是将继承换为多态，总而避免了类数量的急剧增长。</p><hr><h1 id=对象创建模式><a class=markdownIt-Anchor href=#对象创建模式></a> 对象创建模式</h1><p>通过“对象创建” 模式绕开new，来避免对象创建（new）过程中所导致的紧耦合（依赖具体类），从而支持对象创建的稳定。它是接口抽象之后的第一步工作。</p><p>简单来说，就是让这个类文件中new的对象，像virtual函数那样，晚绑定。<br>也就是依赖倒置原则，不依赖与实现，应该依赖与抽象。</p><p>如果一个类文件中，有一处实现，那么可能在以后的过程中，就要去改这个类文件。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/cpp/ rel=tag># cpp</a></div><div class=post-nav><div class=post-nav-item><a href=/CS/dosign_pattern/dosign-pattern-1/ rel=prev title=设计模式-八大设计原则（一）><i class="fa fa-chevron-left"></i> 设计模式-八大设计原则（一）</a></div><div class=post-nav-item><a href=/share/install-app/ rel=next title=ubuntu一些应用>ubuntu一些应用 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class=comments id=disqus_thread><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; <span itemprop=copyrightYear>2024</span> <span class=with-love><i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>ohayo</span></div><div class=powered-by>由 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/ rel=noopener target=_blank>NexT.Gemini</a> 强力驱动</div></div></footer><script src=https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/next-boot.js></script><script src=https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script src=/js/third-party/pace.js></script><script class=next-config data-name=enableMath type=application/json>false</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity="sha256-TThEtR+XalhWKkfF383YLOrI50NGNeIqrzS+q08afrY=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.css integrity="sha256-Wk20U9mS/kHGcSgkjSiRezW5exqT6wAOKwySOaLotXM=" crossorigin=anonymous><script class=next-config data-name=katex type=application/json>{"copy_tex_js":{"url":"https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.js","integrity":"sha256-etSqbSVF4+Lwe8MGk/Vanc1sR+mWv+qOG73fxWw9p94="}}</script><script src=/js/third-party/math/katex.js></script><script class=next-config data-name=disqus type=application/json>{"enable":true,"shortname":"ohayo1213","count":true,"i18n":{"disqus":"disqus"}}</script><script src=/js/third-party/comments/disqus.js></script></body></html>