{
    "version": "https://jsonfeed.org/version/1",
    "title": "ohayo's blog • All posts by \"soft\" category",
    "description": null,
    "home_page_url": "https://blog.ohayo.live",
    "items": [
        {
            "id": "https://blog.ohayo.live/soft/quantumultx/quantumult-x-and-js/",
            "url": "https://blog.ohayo.live/soft/quantumultx/quantumult-x-and-js/",
            "title": "Quantumult X的JavaScript编写",
            "date_published": "2022-05-10T08:43:35.000Z",
            "content_html": "<p>:::info<br />\nQuantumult X是大二上学期入手的。本着15块钱不能白花的想法，这些天研究了一下。</p>\n<p>上一篇内容大致说了一下Quantumult X，但是最激动人心的莫过于可以运行JavaScript。</p>\n<p><ins>请自行补充<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript\">JavaScript基础知识</a>。</ins><br />\n:::</p>\n<h1 id=\"b站签到\"><a class=\"markdownIt-Anchor\" href=\"#b站签到\"></a> b站签到&gt;.&lt;</h1>\n<h2 id=\"抓签到包\"><a class=\"markdownIt-Anchor\" href=\"#抓签到包\"></a> 抓签到包</h2>\n<p>F12，签到，找签到数据包</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220510170502967.png\" alt=\"image-20220510170502967\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220510170538309.png\" alt=\"image-20220510170538309\" /></p>\n<h2 id=\"编写脚本\"><a class=\"markdownIt-Anchor\" href=\"#编写脚本\"></a> 编写脚本</h2>\n<p>其实Quantumult X有自动生成脚本，但是面对复杂的，它是解决不了的啦。</p>\n<p>下面是我写的一个类，可以方便以后进行操作哈。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">initEnv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">//读取Quantumult X数据库里面的数据</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">read</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token keyword\">return</span> $prefs<span class=\"token punctuation\">.</span><span class=\"token function\">valueForKey</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//通知</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">notify</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> subtitle<span class=\"token punctuation\">,</span> message</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> subtitle<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token comment\">//随机数</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getRandom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">min<span class=\"token punctuation\">,</span>max</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">-</span> min <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> min<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//延迟</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sleep</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">milliseconds</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> currentDate <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span>\n            currentDate <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>currentDate <span class=\"token operator\">-</span> date <span class=\"token operator\">&lt;</span> milliseconds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//get请求</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        options<span class=\"token punctuation\">[</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"GET\"</span>\n        $task<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">reason</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//post请求</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">post</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        options<span class=\"token punctuation\">[</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"POST\"</span>\n        $task<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">reason</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//结束</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">done</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token function\">$done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>先在Quantumult X下创建一个js文件</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220510171348307.png\" alt=\"image-20220510171348307\" /></p>\n<p>把刚刚的类复制到最下面，然后就可以写代码啦。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//先初始化一个类</span>\n<span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">initEnv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>咱们开始写一个函数，完成签到的操作。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">dosign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.live.bilibili.com/xlive/web-ucenter/v1/sign/DoSign\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token string-property property\">\"cookie\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"自己的cookie\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"user-agent\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39\"</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> myRequest <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span>url<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span>headers\n    <span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token comment\">//发一个get请求</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>myRequest<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span>response</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        $<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//这个代表结束整个程序。</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token comment\">//调用函数即可</span>\n<span class=\"token function\">dosign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220510172959875.png\" alt=\"image-20220510172959875\" /></p>\n<p>根据俩次的请求回应，我们修改一下签到函数。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">dosign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.live.bilibili.com/xlive/web-ucenter/v1/sign/DoSign\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token string-property property\">\"cookie\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"your cookie\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"user-agent\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39\"</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> myRequest <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span>url<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span>headers\n    <span class=\"token punctuation\">&#125;</span>\n\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>myRequest<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span>response</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">.</span>code<span class=\"token operator\">===</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n                $<span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bili签到~\"</span><span class=\"token punctuation\">,</span>body<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">,</span>body<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>specialText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n                $<span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bili签到~\"</span><span class=\"token punctuation\">,</span>body<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        $<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>运行结果如下</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220510173731266.png\" alt=\"image-20220510173731266\" /></p>\n<h2 id=\"自动获取cookie\"><a class=\"markdownIt-Anchor\" href=\"#自动获取cookie\"></a> 自动获取COOKIE</h2>\n<p>Quantumult X内部有一个小型的数据库，也就是官网的数据持久化操作。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220510174340728.png\" alt=\"image-20220510174340728\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220510174424044.png\" alt=\"image-20220510174424044\" /></p>\n<p>同时Quantumult X的rewrite操作可以运行js脚本，我们只需要，把cookie放入这里面就行啦。</p>\n<h2 id=\"cookie存入函数\"><a class=\"markdownIt-Anchor\" href=\"#cookie存入函数\"></a> cookie存入函数</h2>\n<p>下面的代码是在Github上找到一个获取COOKIE的模板。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getCookie</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">var</span> currentC <span class=\"token operator\">=</span> $request<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>Cookie<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">existC</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">key</span> <span class=\"token operator\">=></span> $prefs<span class=\"token punctuation\">.</span><span class=\"token function\">valueForKey</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">create</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">currentC<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> $prefs<span class=\"token punctuation\">.</span><span class=\"token function\">setValueForKey</span><span class=\"token punctuation\">(</span>currentC<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>currentC <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">existC</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n      currentC <span class=\"token operator\">!=</span> <span class=\"token function\">existC</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span>\n      <span class=\"token punctuation\">(</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>currentC<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"更新Cookie成功\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\"目前的cookie一致\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n          currentC <span class=\"token operator\">!=</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">?</span> \n          <span class=\"token punctuation\">(</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>currentC<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"获取cookie成功\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> \n          <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"获取Cookie失败\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">$done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>编辑一个重写，当打开b站直播中心时自动运行，获取cookie，放入数据库中。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>$request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DoSign\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">getCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BiliBili\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"biliCookie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getCookie</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">var</span> currentC <span class=\"token operator\">=</span> $request<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>Cookie<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">existC</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">key</span> <span class=\"token operator\">=></span> $prefs<span class=\"token punctuation\">.</span><span class=\"token function\">valueForKey</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">create</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">currentC<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> $prefs<span class=\"token punctuation\">.</span><span class=\"token function\">setValueForKey</span><span class=\"token punctuation\">(</span>currentC<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>currentC <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">existC</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n      currentC <span class=\"token operator\">!=</span> <span class=\"token function\">existC</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span>\n      <span class=\"token punctuation\">(</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>currentC<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"更新Cookie成功\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\"目前的cookie一致\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n          currentC <span class=\"token operator\">!=</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">?</span> \n          <span class=\"token punctuation\">(</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>currentC<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"获取cookie成功\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> \n          <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"获取Cookie失败\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token function\">$done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>挂到到重写上即可</p>\n<pre class=\"line-numbers language-conf\" data-language=\"conf\"><code class=\"language-conf\">hostname &#x3D; api.live.bilibili.com\n\n^https:\\&#x2F;\\&#x2F;api\\.live\\.bilibili\\.com\\&#x2F;xlive\\&#x2F;web-ucenter\\&#x2F;v1\\&#x2F;sign\\&#x2F;DoSign url script-request-header https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;zhu-jiyuan&#x2F;myJavaScripts&#x2F;master&#x2F;biliGetCookie.js<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"htu校园网web认证\"><a class=\"markdownIt-Anchor\" href=\"#htu校园网web认证\"></a> HTU校园网web认证</h1>\n<p>quantumult X 的网络请求是异步的，这对于咱一直没用过异步的孩子，多少有些痛苦。</p>\n<p>由于这个脚本需要串行执行。</p>\n<p>思路是这样的，先访问1.1.1.1，获取web认证的userip和认证ip，然后把获得的ip填入校园网认证表单中，发送POST请求，完成认证。</p>\n<p>写了两种方式实现，仅供参考</p>\n<h2 id=\"await串行\"><a class=\"markdownIt-Anchor\" href=\"#await串行\"></a> await串行</h2>\n<p>await会让等待异步执行完之后，再执行下面的代码。但是只能在异步函数中使用。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">\n<span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">initEnv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> stuNo <span class=\"token operator\">=</span> <span class=\"token string\">\"学号\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> passwd <span class=\"token operator\">=</span> <span class=\"token string\">\"密码\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> ips <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">getIp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ips<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getIp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://1.1.1.1\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> myquests <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> url<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headers\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>myquests<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span>response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">//console.log(body);</span>\n                ips <span class=\"token operator\">=</span> body<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">//console.log(ips);</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">loginHtu</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://\"</span><span class=\"token operator\">+</span>ips<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">\"/portalAuthAction.do\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token string-property property\">\"wlanuserip\"</span><span class=\"token operator\">:</span>ips<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"wlanacname\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"HNSFDX_H3C-S8808-X\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"chal_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"chal_vector\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"auth_type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"PAP\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"seq_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"req_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"wlanacIp\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"210.42.255.60\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"ssid\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"vlan\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"mac\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"bank_acct\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"isCookies\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"authkey\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"88----89\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"url\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"usertime\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0 \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"listpasscode\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"listgetpass\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"getpasstype\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"randstr\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2880\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"domain\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"isRadiusProxy\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"false\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"usertype\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0 \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"isHaveNotice\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"times\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"12\"</span><span class=\"token punctuation\">,</span><span class=\"token string-property property\">\" weizhi\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span><span class=\"token string-property property\">\" smsid\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"freeuser\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"freepasswd\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"listwxauth\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"templatetype\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1 \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"tname\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"shida_pc_portal_V1.1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"logintype\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"act\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"is189\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"false\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"terminalType\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"checkterminal\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"portalpageid\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"101\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"listfreeauth\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"viewlogin\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"userid\"</span><span class=\"token operator\">:</span>stuNo<span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"authGroupId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"useridtemp\"</span><span class=\"token operator\">:</span>stuNo<span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"passwd\"</span><span class=\"token operator\">:</span>passwd\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">const</span> myquests <span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span>url<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span>headers<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span>\n\t\t$<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>myquests<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span>response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n\n\n    \n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">initEnv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">read</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token keyword\">return</span> $prefs<span class=\"token punctuation\">.</span><span class=\"token function\">valueForKey</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">notify</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> subtitle<span class=\"token punctuation\">,</span> message</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> subtitle<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getRandom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">min<span class=\"token punctuation\">,</span>max</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">-</span> min <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> min<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sleep</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">milliseconds</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> currentDate <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span>\n            currentDate <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>currentDate <span class=\"token operator\">-</span> date <span class=\"token operator\">&lt;</span> milliseconds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//get请求</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        options<span class=\"token punctuation\">[</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"GET\"</span>\n        $task<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">reason</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//post请求</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">post</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        options<span class=\"token punctuation\">[</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"POST\"</span>\n        $task<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">reason</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//结束</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">done</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token function\">$done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"回调串行\"><a class=\"markdownIt-Anchor\" href=\"#回调串行\"></a> 回调串行</h2>\n<p>这个请参考MDN上的JavaScript教程</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Variables used by Scriptable.</span>\n<span class=\"token comment\">// These must be at the very top of the file. Do not edit.</span>\n<span class=\"token comment\">// icon-color: green; icon-glyph: magic;</span>\n\n<span class=\"token comment\">/**\n * Connect HTU WIFI\n * by@zhujiyuan\n * version 1.0\n */</span>\n\n <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">initEnv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">const</span> stdNo <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">const</span> passwd <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n \n <span class=\"token keyword\">let</span> ips <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n \n <span class=\"token function\">connectHTU</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n <span class=\"token keyword\">function</span> <span class=\"token function\">connectHTU</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t <span class=\"token function\">getIp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span>\n\n\t\t<span class=\"token comment\">//console.log(ips[0]);</span>\n\t\t<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'http://'</span><span class=\"token operator\">+</span>ips<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'/portalAuthAction.do'</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token string\">'wlanuserip='</span><span class=\"token operator\">+</span>ips<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'&amp;wlanacname=HNSFDX_H3C-S8808-X&amp;chal_id=&amp;chal_vector=&amp;auth_type=PAP&amp;seq_id=&amp;req_id=&amp;wlanacIp=210.42.255.60&amp;ssid=&amp;vlan=&amp;mac=&amp;message=&amp;bank_acct=&amp;isCookies=&amp;version=&amp;authkey=88----89&amp;url=&amp;usertime=0&amp;listpasscode=0&amp;listgetpass=0&amp;getpasstype=0&amp;randstr=8289&amp;domain=&amp;isRadiusProxy=false&amp;usertype=0&amp;isHaveNotice=0&amp;times=12&amp;weizhi=0&amp;smsid=&amp;freeuser=&amp;freepasswd=&amp;listwxauth=0&amp;templatetype=1&amp;tname=shida_pc_portal_V1.1&amp;logintype=0&amp;act=&amp;is189=false&amp;terminalType=&amp;checkterminal=false&amp;portalpageid=101&amp;listfreeauth=0&amp;viewlogin=1&amp;userid='</span><span class=\"token operator\">+</span>stdNo<span class=\"token operator\">+</span><span class=\"token string\">'&amp;authGroupId=&amp;useridtemp='</span><span class=\"token operator\">+</span>stdNo<span class=\"token operator\">+</span><span class=\"token string\">'&amp;passwd='</span><span class=\"token operator\">+</span>passwd<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//console.log(url);</span>\n\t\t<span class=\"token comment\">//console.log(body);</span>\n\n\t\t \n\t\t<span class=\"token keyword\">const</span> myquests <span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>\n\t\t\t<span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span>url<span class=\"token punctuation\">,</span>\n\t\n\t\t\t<span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span>body\n\t\t <span class=\"token punctuation\">&#125;</span>\n\t\t\n\t\t \n\t\t$<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>myquests<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span>response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">&#125;</span>\n\t\t\t<span class=\"token keyword\">let</span> resp <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token comment\">//console.log(resp);</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"河南师范\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HTU connection success~\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            \t<span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HTU connection failed\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            \t<span class=\"token punctuation\">&#125;</span>\n\t\t\t$<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n\t <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">&#125;</span>\n \n \n <span class=\"token keyword\">function</span> <span class=\"token function\">getIp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cb</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\t <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://1.1.1.1\"</span><span class=\"token punctuation\">;</span>\n\t <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n\t <span class=\"token keyword\">const</span> myquests <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n\t\t <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> url<span class=\"token punctuation\">,</span>\n\t\t <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headers\n\t <span class=\"token punctuation\">&#125;</span>\n\t $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>myquests<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span>response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">;</span>\n\t\t\t <span class=\"token comment\">//console.log(body);</span>\n\t\t\t ips <span class=\"token operator\">=</span> body<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d&#123;2&#125;|[1-9]?\\d)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t <span class=\"token comment\">//console.log(ips[1]);</span>\n\t\t\t <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ips<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">===</span><span class=\"token string\">\"1.1.1.1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\t\t\t\t <span class=\"token comment\">//console.log(\"over!\");</span>\n\t\t\t\t $<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t <span class=\"token punctuation\">&#125;</span>\n\t\t\t <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span> \n <span class=\"token punctuation\">&#125;</span>\n \n \n \n <span class=\"token keyword\">function</span> <span class=\"token function\">initEnv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n \n\t <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">read</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t <span class=\"token keyword\">return</span> $prefs<span class=\"token punctuation\">.</span><span class=\"token function\">valueForKey</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t <span class=\"token punctuation\">&#125;</span>\n\t <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">notify</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> subtitle<span class=\"token punctuation\">,</span> message</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t <span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> subtitle<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t <span class=\"token punctuation\">&#125;</span>\n \n\t <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getRandom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">min<span class=\"token punctuation\">,</span>max</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">-</span> min <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> min<span class=\"token punctuation\">;</span>\n\t <span class=\"token punctuation\">&#125;</span>\n\t <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sleep</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">milliseconds</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t <span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t <span class=\"token keyword\">let</span> currentDate <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t\t <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t currentDate <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>currentDate <span class=\"token operator\">-</span> date <span class=\"token operator\">&lt;</span> milliseconds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t <span class=\"token punctuation\">&#125;</span>\n\t <span class=\"token comment\">//get请求</span>\n\t <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t options<span class=\"token punctuation\">[</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"GET\"</span>\n\t\t $task<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span>\n\t\t <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">reason</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t <span class=\"token punctuation\">&#125;</span>\n\t <span class=\"token comment\">//post请求</span>\n\t <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">post</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t options<span class=\"token punctuation\">[</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"POST\"</span>\n\t\t $task<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span>\n\t\t <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">reason</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t <span class=\"token punctuation\">&#125;</span>\n\t <span class=\"token comment\">//结束</span>\n\t <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">done</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n\t\t <span class=\"token function\">$done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t <span class=\"token punctuation\">&#125;</span>\n <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n \n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>（待更新，如果你有看到我，请提醒他去更新一下）</p>\n<hr />\n<h1 id=\"change-logs\"><a class=\"markdownIt-Anchor\" href=\"#change-logs\"></a> Change logs</h1>\n<h2 id=\"may-252022\"><a class=\"markdownIt-Anchor\" href=\"#may-252022\"></a> May 25,2022</h2>\n<ul>\n<li>更新校园网js示例</li>\n</ul>\n",
            "tags": [
                "JavaScript"
            ]
        },
        {
            "id": "https://blog.ohayo.live/soft/quantumultx/quantumult-x-note/",
            "url": "https://blog.ohayo.live/soft/quantumultx/quantumult-x-note/",
            "title": "Quantumult X一款神奇的软件",
            "date_published": "2022-05-04T15:40:49.000Z",
            "content_html": "<p>quantumult x，一款路由软件。<br />\n简单的说，这个软件可以实现如下</p>\n<ul>\n<li>VPN代理</li>\n<li>路由分流</li>\n<li>捕获网络请求，也就是在应用层抓包</li>\n<li>重写数据包</li>\n<li>执行JavaScript脚本</li>\n</ul>\n<p>这款软件的性价比太高了，很遗憾的是，作者没有给予相关的文档，所以开始的小白很难折腾。还好作者在GitHub上给了相关的sample。<a href=\"https://github.com/crossutility/Quantumult-X\">quantumult x官方</a></p>\n<h1 id=\"相关资料\"><a class=\"markdownIt-Anchor\" href=\"#相关资料\"></a> 相关资料</h1>\n<p>这里我收集了一些网上的资料。</p>\n<p>大致配置，相关功能的介绍几乎都在这个作者写的====&gt;<a href=\"https://www.notion.so/Quantumult-X-1d32ddc6e61c4892ad2ec5ea47f00917\">Quantumult-X不完全教程</a></p>\n<p>这篇文章大致讲了配置文件的基本格式，以及各个功能。</p>\n<h1 id=\"术语简解\"><a class=\"markdownIt-Anchor\" href=\"#术语简解\"></a> 术语简解</h1>\n<p>简单解释一下，这几个在配置文件中的模块是啥意思。详细的请看上面的教程。</p>\n<p>首先说一下quantumult x支持远程挂载文件，就你可以直接过载github或者服务器上托管的配置或者规则。</p>\n<p>所有在remote标签下的都是远程挂载的配置文件，在local下都是本地的配置文件。</p>\n<ul>\n<li>\n<p>分流（filter），比如你有一个科学上网的节点，国内网站你想直接用本地的网，国外网站用自己的节点。这个需要分流进行实现。分流一共三类。</p>\n<ul>\n<li>direct，走本地的网络，直连</li>\n<li>reject，直接丢掉，不入站。把广告的host走reject，就会把广告屏蔽掉。</li>\n<li>proxy，代理，就是走选择的代理节点。</li>\n</ul>\n</li>\n<li>\n<p>重写（rewrite），这个是quantumult x里的BEST功能之一了，你可以把收到的response进行重写，再返回给你的设备，这样就可以破解一些东西。同时还可以重写request。十分强大。后续再说。</p>\n</li>\n<li>\n<p>server，这个就是节点。节点就在这里添加。</p>\n</li>\n<li>\n<p>general是一般配置，这个在相关资料里说的很清楚了。不懂可以去那里看哈。</p>\n</li>\n<li>\n<p>dns，域名解析，你可以多添加几个dns服务器，quantumult x会测试这些dns服务器，选择最优的。</p>\n</li>\n<li>\n<p>policy，策略组，这是quantumult x进行解耦的神器，不得不说作者有些东西，为了更方便管理分流和节点，quantumult x提出了策略组，策略组可以管理特定的host走哪个分流，或者那个节点。</p>\n</li>\n<li>\n<p>task，quantumult x执行js脚本的配置。</p>\n</li>\n<li>\n<p>http_backend，http捕获配置，没研究过这个，待填坑。</p>\n</li>\n<li>\n<p>mitm，在添加完quantumult x的CA证书后，quantumult x有权力对你的流量进行分析包含https，但是它不会全部进行分析，只对hostname里面的host进行分析。</p>\n</li>\n</ul>\n<h1 id=\"配置\"><a class=\"markdownIt-Anchor\" href=\"#配置\"></a> 配置</h1>\n<p>我的配置分流参考了这几位作者的。</p>\n<ul>\n<li><a href=\"https://github.com/KOP-XIAO/QuantumultX\">KOP-XIAO</a>的资源解析器</li>\n<li><a href=\"https://github.com/DivineEngine/Profiles\">DivineEngine</a>的分流、重写策略</li>\n<li><a href=\"https://github.com/nondanee/UnblockNeteaseMusic\">网易云解锁</a>，自己的国内服务器搭建的。</li>\n<li>以及自己做的一些分流规则，重写规则</li>\n<li>自己的JavaScript脚本</li>\n</ul>\n<p>规则不难写，很多前人收集好的，fork一份备份，换成自己的，定时更新备份。就行啦。</p>\n<p>了解完大致的规则，慢慢就会做出来适合自己的配置。十分的香。</p>\n<h1 id=\"javascript之疑惑\"><a class=\"markdownIt-Anchor\" href=\"#javascript之疑惑\"></a> JavaScript之疑惑</h1>\n<p><s>quantumult x没有给相关的api文档，这可真是太难受了，家人们，破防了。还好有些人以及写好了一些js示例。加上sample上面有些注释。。。我大致悟到了这么多东西。</s></p>\n<p>JS所有的API，都在自带的配置模板里，如果之前没有用过JavaScript发送网络请求等，还是十分建议参考=&gt;<a href=\"https://zhujiyuan.xyz/2022/05/10/quantumult-x-and-js/\">这篇</a></p>\n<h2 id=\"cookie问题\"><a class=\"markdownIt-Anchor\" href=\"#cookie问题\"></a> cookie问题</h2>\n<p>quantumult x内封装了一个轻量级数据库，存放键值对，就是quantumult x的持久化策略，利用重写，捕获request包的headers，可以放到里面供js脚本使用。</p>\n<h2 id=\"jd签到的脚本怎么写\"><a class=\"markdownIt-Anchor\" href=\"#jd签到的脚本怎么写\"></a> jd签到的脚本怎么写？</h2>\n<p>GitHub开源的京东脚本作者，写了一个env环境的class，这个类可以更方便的发post，get等请求，同时判断是quantumult x还是小火箭等app。</p>\n<h2 id=\"广告过滤\"><a class=\"markdownIt-Anchor\" href=\"#广告过滤\"></a> 广告过滤</h2>\n<p>这个是quantumult x一个很吸引人的地方了，quantumult x可以分流过滤广告，就是自己设置或者抄别人的规则，广告全部走reject。练习可以找QQ空间的广告联系。<br />\n最nb的是js重写过滤，重写可以在request和response两个地方运行js脚本，之前有过python爬虫经验的狂喜！！！知道该怎么做了吧，这个就不说了。</p>\n<h2 id=\"网易云音乐解锁\"><a class=\"markdownIt-Anchor\" href=\"#网易云音乐解锁\"></a> 网易云音乐解锁</h2>\n<p>这个就是在服务器上搭建一个节点，然后在你进网易云听歌的时候，网易云音乐域名走服务器搭建的这个节点，返回给你其他音乐平台的歌曲直链。设置好分流和策略组即可。<br />\n这个节点搭建坑比较多。回头说</p>\n<h2 id=\"调试js问题\"><a class=\"markdownIt-Anchor\" href=\"#调试js问题\"></a> 调试js问题</h2>\n<p>quantumult x的js调试太不方便了，对我来说，我目前手上没得mac。只有iPad和iPhone个一台。<br />\n我的方案是，  <s>windows电脑搭建一个samba服务器，苹果自带的文件可以直接连默认端口的samba服务器，然后让quantumult x直接跑samba里面的js。</s>  windows下挂载iCloud云盘，直接修改quantumult x下的js文件。<br />\n<img src=\"https://cdn.jsdelivr.net/gh/zhu-jiyuan/picture_go/img/image-20220509213606111.png\" alt=\"image-20220509213606111\" /></p>\n<hr />\n<h1 id=\"change-logs\"><a class=\"markdownIt-Anchor\" href=\"#change-logs\"></a> Change logs</h1>\n<h2 id=\"may-92022\"><a class=\"markdownIt-Anchor\" href=\"#may-92022\"></a> May 9,2022</h2>\n<ul>\n<li>Javascript在另一篇。</li>\n<li>更改js调试方案。</li>\n</ul>\n<h2 id=\"may-252022\"><a class=\"markdownIt-Anchor\" href=\"#may-252022\"></a> May 25,2022</h2>\n<ul>\n<li>更新JavaScript问题</li>\n</ul>\n",
            "tags": [
                "log"
            ]
        }
    ]
}